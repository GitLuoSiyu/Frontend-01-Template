# 每周总结可以写在这里

## 组件化学习的开启

虽然winter老师还没开始组件工具链的课程，目前仍停留在CSS阶段，但是小弟一直希望能够组件一套自己的组件库。
回顾老师之前上课的内容，一个完善的工具链，或者组件库，至少有三大阶段，6个步骤，完整生命周期包括：
- init，初始化组件根节点和配置
- fetch，加载 css 和 js 资源
- render，内容渲染，默认的渲染内容方式是 BigRender
- ready，进行数据绑定等操作
- update，数据更新
- destroy，解除所有事件监听，删除所有组件节点

组件提供 pause、resume 方法以方便进行生命周期控制。各个阶段使用 Promise 串行进行，异步的管理更清晰。使用自定义语义事件，在修改默认行为、组件间通信上充分利用了 YUI 强大的自定义事件体系，有效降低了开发维护成本。

举个例子，页面初始化时组件的启动过程实际也是借助生命周期实现的：
```javascript
var afterLoadList = [];
Y.all('[data-component]').each(function (node) {
    var component = new Y.mt.Component(node);
    // 绑定 init 生命周期事件，在 init 默认行为完成后执行回调
    component.after('init', function (e) {
        // 如果配置了延迟启动
        if (e.config.afterLoad) {
            // 暂停组件生命周期
            e.component.pause();
            // 压入延迟启动数组
            afterLoadList.push(e.component);
        }
    });
    // 开始进入生命周期
    component.start();
});
 
Y.on('load', function () {
    // 在页面 load 事件发生时恢复组件生命周期
    afterLoadList.forEach(function (component) {
        component.resume();
    });
});
```
回过头来看，引入生命周期除了带来扩展性外，更重要的是理顺了组件的各个阶段，有助于更好的理解和运用。

## 前端性能指标

在互联网网站百花齐放的今天，网站响应速度是用户体验的第一要素，其重要性不言而喻，这里有几个关于响应时间的重要条件：

用户在浏览网页时，不会注意到少于0.1秒的延迟；
少于1秒的延迟不会中断用户的正常思维， 但是一些延迟会被用户注意到；
延迟时间少于10秒，用户会继续等待响应；
延迟时间超过10秒后，用户将会放弃并开始其他操作；
而在美团，“消费者第一”是公司的第一价值观，为了给消费者提供更好的用户体验，美团网的技术Geeker们在性能优化的路上做了不少的工作，开发了许多工具让网站的性能监测更容易，通过各种可视化报表，工程师们只需要点点鼠标就能看到网站的性能数据，并能根据数据来预测系统的性能趋势，快速发现有价值的优化点。在本文中，不讲best practices，也不去讲具体的优化手段，仅从美团日常通用的性能指标体系的角度去分享美团的实践。


### 性能指标的分类
为了更好的去监控整个系统的性能，做好全流程的优化，美团将指标分为了以下3类：

- Perceived system performance：这类指标主要从工程师的角度去衡量，如后端的响应时间，当前并发的用户数，请求数，请求的错误率等等。
- Perceived user experience：这类指标用来衡量⽤户的真实体验，从用户体验的角度出发，如首屏时间，白屏时间，完全加载时间之类，即用户能实际感觉到得网页加载延迟。
- System performance：这类指标从服务器的角度出发，监测目前服务器的CPU、内存、网络带宽、流量等等物理资源。
对于上述的每一类，衡量标准可能都不一样，在数据展示方面，主要通过趋势图和汇总表格来展现，下面来对这3类指标分别细说：
- Perceived system performance
这类指标主要为工程师设计，来衡量业务后端的处理速度，主要从以下几个方面去衡量：

1) 响应时间
在美团，响应时间是性能的主要kpi，对于响应时间，美团做了很多精细化的处理； 首先对每个业务的整体(集群)响应时间有个衡量：

- 95%的响应时间：将一段时间内所有请求的响应时间中取一个值，使95%的请求响应时间均小于或等于它，此值即为95%请求覆盖的响应时间。
- 90%的响应时间：将一段时间内所有请求的响应时间中取一个值，使90%的请求响应时间均小于或等于它，此值即为90%请求覆盖的响应时间。
- 50%的响应时间：将一段时间内所有请求的响应时间中取一个值，使50%的请求响应时间均小于或等于它，此值即为50%请求覆盖的响应时间。
以某内部服务为例，3条不同的曲线分别代表了3种不同的响应时间维度：


另外为了方便工程师的优化，对具体到每个请求url都做了更精细化的统计，不光统计了上述的指标，还增加了：

最大响应时间：某请求的某段时间范围内响应时间的最大值。
最小响应时间: 某请求的某段时间范围内响应时间的最小值。
时间标准差：某请求某段时间范围内的波动情况，用来衡量某请求是否存在很大波动，标准差越大，波动越大。
以某内部服务为例，通过汇总表格展现出某小时的某url的更细响应时间的维度：




