# 每周总结可以写在这里

## App Clip 应用剪影
本周winter老师主要讲解了JSX语法和react相关的知识，包括封装了一个 轮播组件，还补了一节写作课。不过本周我想记录的是一项正在学习的技能。

6 月22日，苹果在其年度全球开发者大会（WWDC）上，宣布了新款 iOS 14 的应用剪辑功能（App Clip）。应用程序剪辑，是允许用户快速预览应用程序的一个“半屏裤衩”页面，而无需下载它们。

它给人的感觉就像是美国版的小程序。

>官网是这么描述的:扫描一个二维码，一个专用的应用程序剪辑码、或 NFC 标签时、或者单击一个Safari启动条、或者从短信中单击链接、或者从地图Map中单击一个锚点时。你的 iPhone 将启动应用程序剪辑卡。你可以点击打开并启动应用剪辑，而不下载它。应用程序剪辑与苹果支付、苹果登录无缝兼容。这意味着你不需要在应用程序上建立账户或者使用你的信用卡信息。用户可以用它支付外卖或停车费，还可以进一步了解更多信息。

所以可以间接把它理解为“苹果小程序码”。

一个小于 10MB 的 App 软件包，并不是不需要下载，而是苹果在后台默默给你下载好了。如果不是网络环境变好了，根据不太可能做到几秒内加载并启动。

让使用 2g 网络的非州兄弟用用，看能不能在几秒内点开。当然，非州兄弟也不使用苹果手机，据说用华为手机的更多一些。

可以把这个应用剪辑（App Clip），看作是一个内嵌于苹果手机这个大应用中的一个页面，可以通过一个链接（虽然可以扫码启动，可以通过NFC启动，本质上还是一个链接）启动。启动的时候，其实是从苹果服务器上，下载了这个页面。

并且估计做了缓存，下次打开同样的应用剪辑时，就不需要重复下载了。当然这里面不知道苹果有没有抄袭微信小程序冷启动、热切换机制。是每次都检查新版本，还是只有冷启动时才检查应用剪辑的新版本呢？

在微信小程序刚要上线时，听说“应用号”这个名称，因为被苹果婉拒而生生改成了小程序。是不是那个时候，苹果已经开始谋划这个“应用剪辑”的功能了呢？三年磨一剑，这确实符合苹果的风格。

### 如何开发AppClip
首先，能不能用 js/css 开发它？

没戏。至少目前没戏，以后有了第三方类库或工具或许可能吧。关于如何开发，这里有一个官方介绍：https://developer.apple.com/documentation/app_clips/creating_an_app_clip。这篇文档大意是讲，应用剪辑的开发和普通App的开发是类似的，只需要将 Xcode 升级到 12 beta 版本就可以了。并且官方建议我们，和 App 使用同样的一套代码。只是在原项目上多创建一个编译目标。苹果把本来是一个 App 的内容，现在重构一个手机内页面，并且执行包估计也是二进制形式的，确实旗高一筹。这大概就是手握软硬件，控制上下游的好处吧。如果微信有一部自己的手机，可能微信小程序也这么干了。

### 实现方式：native 代码、native 框架、native app 一样的分发
在实现上，AppClip 和原生的 app 使用一样的方式。在 UI 框架上同时支持 UIKit 和 SwiftUI，有些开发者认为只能使用 SwiftUI 开发，这点是错误的。AppClip 的定位和 watch app、app extension 类似，和 app 在同一个 project 里，是一个单独的 target。只是 AppClip 并没有自己的专属 framework（其实有一个，但是主要包含的是一些特色 api），使用的框架和 app 一致，可以认为是一个精简版的原生 App。

AppClip 不能单独发布，必须关联一个 app。因此发布的流程和 app 和一样的，在 apple connect 上创建一个版本，和 app 一起提交审核。和 app 在技术上的最大区别只是大小限制在 10MB 以内，因为 AppClip 的基础就是希望用户可以最迅速的被用户使用，如果体积大了就失去了产品的根本。

### 产品定位：用完即走
AppClip 的定位和小程序的初衷一样，用完即走，不过多占用用户的内存空间。尤其是微信小程序在国内已经完全普及了，微信小程序初始发布的时候也被苹果加了多条限制。其中一条就是小程序不能有虚拟商品支付功能。现在回头看苹果自己的 AppClip 可以完美支持 apple pay，很难说苹果没有私心(借鉴小程序?)。


AppClip 使用一段 URL 标识自己，格式遵从 universal link。因为苹果对 Clip 的使用场景非常明确，所以在 Clip 的调起方式做了严格限制。Clip 的调用只能是用户主动要发起才能访问，所以不存在用户在某个 app 里不小心点了一个按钮，就跳转下载了 Clip。







